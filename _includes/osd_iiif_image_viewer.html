{% assign thispage = site.data.pages | where: "canvas", include.canvas | first %}  
{% capture default_region %}0,0,{{thispage.width}},{{thispage.height}}{% endcapture %}
<div id="osd_{{ include.id }}" class="image-viewer" style="height: {{ include.height | default: '120vh' }}">
<script>
  var conf = {
    id:           "osd_{{ include.id }}",
    prefixUrl:    "https://openseadragon.github.io/openseadragon/images/",
    sequenceMode: true,
    showRotationControl: true,
    degrees: {{ include.degrees | default: 0 }},
    tileSources:  ["https://iiif.archive.org/image/iiif/3/manualonmethodso00robe%2fmanualonmethodso00robe_jp2.zip%2fmanualonmethodso00robe_jp2%2fmanualonmethodso00robe_{{ include.canvas | prepend: '0000' | slice: -4, 4 }}.jp2/info.json"]
  };

  var viewer = OpenSeadragon(conf);

  viewer.addHandler('open', function() {
    var tiledImage = viewer.world.getItemAt(0); 
    var imageRect = new OpenSeadragon.Rect({{ include.region | default: default_region }}); 
    var viewportRect = tiledImage.imageToViewportRectangle(imageRect);
    viewer.viewport.fitBounds(viewportRect, true);
  });
</script>
</div>
